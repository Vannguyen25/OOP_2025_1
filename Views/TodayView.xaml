<UserControl x:Class="OOP_Semester.Views.TodayView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="800"
             FontFamily="Segoe UI">

    <ScrollViewer VerticalScrollBarVisibility="Hidden" PanningMode="VerticalOnly">
        <Grid Margin="0,0,0,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Text="Today's Focus" FontSize="24" FontWeight="Bold" Margin="0,0,0,20" Foreground="#1c1c0d"/>

            <Grid Grid.Row="1" Margin="0,0,0,30">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="15"/>
                    <ColumnDefinition Width="1.2*"/>
                </Grid.ColumnDefinitions>

                <Border Grid.Column="0" Background="White" CornerRadius="24" Padding="25">
                    <Border.Effect>
                        <DropShadowEffect Color="#DDD" BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                    </Border.Effect>
                    <Grid>
                        <StackPanel>
                            <TextBlock Text="{Binding Greeting}" FontSize="22" FontWeight="Black" Foreground="#1c1c0d"/>
                            <TextBlock Text="{Binding StreakMessage}" FontSize="14" Foreground="#757564" Margin="0,4,0,20"/>

                            <StackPanel Orientation="Horizontal">
                                <Grid Margin="0,0,30,0">
                                    <Ellipse Width="45" Height="45" Stroke="#f58634" StrokeThickness="4"/>
                                    <TextBlock Text="{Binding DailyProgressPercent, StringFormat={}{0}%}" 
                                               HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold"/>
                                </Grid>
                                <StackPanel VerticalAlignment="Center" Margin="0,0,40,0">
                                    <TextBlock Text="Daily Goal" FontSize="11" Foreground="#999" FontWeight="Bold" />
                                    <TextBlock Text="Keep going!" FontWeight="Bold"/>
                                </StackPanel>

                                <Rectangle Width="1" Fill="#EEE" Height="30" VerticalAlignment="Center"/>

                                <StackPanel VerticalAlignment="Center" Margin="30,0,0,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="💰" FontSize="16" Margin="0,0,5,0"/>
                                        <StackPanel>
                                            <TextBlock Text="COINS" FontSize="11" Foreground="#999" FontWeight="Bold"/>
                                            <TextBlock Text="{Binding Coins, StringFormat={}{0} Earned}" FontWeight="Bold"/>
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Grid.Column="2" Background="#f58634" CornerRadius="24" Padding="20">
                    <Grid>
                        <StackPanel>
                            <Border Background="#33FFFFFF" HorizontalAlignment="Left" CornerRadius="10" Padding="8,2">
                                <TextBlock Text="Active Challenge" Foreground="White" FontSize="10" FontWeight="Bold"/>
                            </Border>

                            <TextBlock Text="{Binding ChallengeName}" Foreground="White" FontSize="18" FontWeight="Bold" Margin="0,15,0,0"/>
                            <TextBlock Text="{Binding ChallengeProgressText}" Foreground="#FFE0B2" FontSize="12" Margin="0,2,0,15"/>

                            <Grid Height="8">
                                <Border Background="#4D000000" CornerRadius="4"/>
                                <Border Background="White" CornerRadius="4" HorizontalAlignment="Left" 
                                        Width="{Binding ChallengePercent}">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Width" Value="80"/>
                                        </Style>
                                    </Border.Style>
                                </Border>
                            </Grid>

                            <Button Content="Continue" Margin="0,15,0,0" Background="White" Foreground="#f58634" 
                                    BorderThickness="0" FontWeight="Bold" Padding="10,6">
                                <Button.Resources>
                                    <Style TargetType="Border">
                                        <Setter Property="CornerRadius" Value="10"/>
                                    </Style>
                                </Button.Resources>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <Grid Grid.Row="2" Margin="0,0,0,15">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="☀️" FontSize="18" Margin="0,0,8,0"/>
                    <TextBlock Text="Morning Routine" FontSize="18" FontWeight="Bold" Foreground="#1c1c0d"/>
                </StackPanel>
                <TextBlock Text="Edit List" HorizontalAlignment="Right" Foreground="#999" Cursor="Hand" VerticalAlignment="Bottom"/>
            </Grid>

            <ItemsControl Grid.Row="3" ItemsSource="{Binding Habits}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" CornerRadius="16" Margin="0,0,0,12" Padding="15">
                            <Border.Effect>
                                <DropShadowEffect Color="#EEE" BlurRadius="5" ShadowDepth="2" Opacity="0.5"/>
                            </Border.Effect>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Border Grid.Column="0" Width="48" Height="48" CornerRadius="12" Margin="0,0,15,0">
                                    <Border.Background>
                                        <SolidColorBrush Color="{Binding ColorHex}"/>
                                    </Border.Background>
                                    <TextBlock Text="{Binding Icon}" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding Title}" FontWeight="Bold" FontSize="15" Foreground="#1c1c0d"/>
                                    <TextBlock Text="{Binding Subtitle}" FontSize="12" Foreground="#888" Margin="0,2,0,0"/>
                                </StackPanel>

                                <ContentControl Grid.Column="2" VerticalAlignment="Center">
                                    <ContentControl.Style>
                                        <Style TargetType="ContentControl">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsCounterType}" Value="True">
                                                    <Setter Property="ContentTemplate">
                                                        <Setter.Value>
                                                            <DataTemplate>
                                                                <StackPanel Orientation="Horizontal" Background="#f8f8f5"  >
                                                                    <Button Content="-" Width="30" Height="30" Background="Transparent" BorderThickness="0" 
                                                                            Command="{Binding DataContext.DecrementCounterCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                            CommandParameter="{Binding}"/>
                                                                    <TextBlock Text="{Binding CurrentCount}" VerticalAlignment="Center" FontWeight="Bold" Margin="5,0"/>
                                                                    <Button Content="+" Width="30" Height="30" Background="White" BorderThickness="0"
                                                                            Command="{Binding DataContext.IncrementCounterCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                            CommandParameter="{Binding}"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>

                                                <DataTrigger Binding="{Binding IsCounterType}" Value="False">
                                                    <Setter Property="ContentTemplate">
                                                        <Setter.Value>
                                                            <DataTemplate>
                                                                <CheckBox IsChecked="{Binding IsCompleted}" 
                                                                          Command="{Binding DataContext.CompleteHabitCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                                          CommandParameter="{Binding}">
                                                                    <CheckBox.LayoutTransform>
                                                                        <ScaleTransform ScaleX="1.5" ScaleY="1.5"/>
                                                                    </CheckBox.LayoutTransform>
                                                                </CheckBox>
                                                            </DataTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ContentControl.Style>
                                </ContentControl>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>
    </ScrollViewer>
</UserControl>